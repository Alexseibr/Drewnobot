Ты — Replit Agent/Codex. Продолжай работу в текущем репозитории. Цель: довести проект до состояния “всё работает” (end-to-end) по всем основным функциям: гость (баня+квадро), админ (операции+задачи+касса+брони+инкассация+доп.часы), инструктор (квадро-сессии+подтверждение), владелец (аналитика+настройки). Не ломай существующее. Все тексты интерфейса на русском.

========================================================
0) ГЛАВНОЕ ТРЕБОВАНИЕ
========================================================
Сделай так, чтобы ВСЕ заявленные функции реально работали:
- все страницы открываются без ошибок
- все формы отправляются и сохраняют данные
- все списки подгружаются и обновляются
- роли ограничивают доступ корректно
- сценарии бронирований не допускают овербукинг
- касса корректно считает остаток и после инкассации админ не видит историю
- уведомления (пока хотя бы лог + заглушка Telegram) отправляются туда, куда настроено

Если чего-то не хватает в API/логике — ДОПИШИ минимально, не усложняя.

========================================================
1) СДЕЛАЙ “КАРТУ ФУНКЦИЙ” И ПРОВЕРЬ ПО НЕЙ
========================================================
Создай docs/FUNCTIONS_MAP.md (на русском) с таблицей:
- Функция
- Роль (гость/админ/инструктор/владелец)
- Страница (route)
- API endpoints
- Статус (OK / FIXED / TODO)
Заполни по факту после проверки.

========================================================
2) СЦЕНАРИИ, КОТОРЫЕ ДОЛЖНЫ ПРОХОДИТЬ (E2E ЛОГИКА)
========================================================
A) Гость — Баня:
1) Открыть “Бронирование бани”
2) Увидеть доступность бань на дату
3) Создать бронь (pending_call)
4) Админ видит бронь в “Брони” и получает уведомление
5) Админ “Принять” -> awaiting_prepayment/confirmed
6) Админ вносит предоплату (50) + метод
7) В день бани админ закрывает оплату (ЕРИП/нал)
8) Бронь становится completed

B) Гость — Квадро:
1) Открыть “Бронирование квадро”
2) Увидеть доступные сессии с remaining quads
3) Создать заявку на 1..remaining квадро
4) Инструктор видит в расписании, подтверждает или отменяет
5) Сессия не позволяет превысить 4 квадро и соблюдает buffer 30 минут

C) Админ — Касса:
1) Открыть смену
2) Создать заселение с наличными => cash_in увеличивает баланс
3) Добавить расход => баланс уменьшается
4) Инкассация закрывает смену, фиксирует cash_out, и админ больше не видит историю смены/транзакций (только новую смену может открыть)

D) Админ — Доп. часы:
1) Создать WorkLog с 12:30–15:45 => duration считается автоматически
2) WorkType можно выбрать из подсказок или написать свой
3) hourlyRate опционально
4) После сохранения админ не видит список старых worklog’ов, владелец видит и получает уведомление

E) Владелец:
1) Открыть аналитику summary за месяц => отображаются суммы и счётчики
2) Открыть настройки => изменить цены и время закрытия => эти значения влияют на расчёт цены и валидации

========================================================
3) ДОПИШИ НЕДОСТАЮЩИЕ API ДЛЯ РАБОЧИХ СТРАНИЦ (ЕСЛИ НУЖНО)
========================================================
Проверь фактические вызовы фронта:
- ops/bookings list: если нет endpoint для "upcoming bookings" — добавь минимальный:
  GET /api/ops/bookings?from=YYYY-MM-DD&to=YYYY-MM-DD&type=all
  Возвращает агрегированный список: cottages + baths + quads (если админ может видеть quads — иначе только owner).
- admin bath actions: если accept/prepayment/close-payment отсутствуют — добавь:
  POST /api/admin/bath-bookings/:id/accept
  POST /api/admin/bath-bookings/:id/prepayment
  POST /api/admin/bath-bookings/:id/close-payment
  Важно: не меняй гостевой endpoint, просто добавь админские.
- cottage bookings: если нет создания домика — добавь:
  POST /api/admin/cottage-bookings (создание админом)
  GET /api/admin/cottage-bookings/upcoming (для ops)
- worklogs: если нет — добавь:
  POST /api/worklogs
- settings: если нет — добавь:
  GET/PUT /api/owner/settings (singleton)

Любые новые endpoints:
- документируй в README
- покрывай минимальным тестом smoke

========================================================
4) ВАЛИДАЦИИ И ОШИБКИ (ДОЛЖНО БЫТЬ ЧЕЛОВЕЧНО)
========================================================
- Все формы должны выдавать понятные ошибки на русском.
- Вся бизнес-валидация на бэке:
  - баня: min 3 часа, end<=22:00, no-overlap на B1/B2
  - квадро: bookedQuads + requested <= 4, запрет пересечений сессий с buffer
  - касса: нельзя делать транзакции без открытой смены (кроме owner)
  - инкассация: только при открытой смене

На фронте:
- disable submit пока идет запрос
- toast/snackbar “Успешно” / “Ошибка”

========================================================
5) УВЕДОМЛЕНИЯ TELEGRAM (СДЕЛАЙ ЧТОБ НЕ “ТИХО”)
========================================================
Сделай общий сервис NotificationService:
- sendToOwner(text)
- sendToAdmin(text)
- sendToInstructor(text)
Если TELEGRAM_*_CHAT_ID не задан — писать в лог с префиксом [NOTIFY].
Триггеры:
- новая бронь бани/квадро (pending_call)
- принятие/предоплата/закрытие оплаты
- новый WorkLog
- инкассация

========================================================
6) DEV AUTH / ТЕСТОВЫЕ РОЛИ (ЧТОБ МОЖНО БЫЛО ПРОВЕРИТЬ ВСЁ)
========================================================
Сделай стабильную dev-авторизацию:
- /api/auth/dev-login (только если NODE_ENV=development)
  body: { role: 'ADMIN'|'OWNER'|'INSTRUCTOR' }
  returns: { token, user }
- фронт: кнопки на главной “Войти как ...” используют этот endpoint
- токен хранится в localStorage и подставляется в axios/fetch

Это должно позволить ПРОВЕРИТЬ всё локально без Telegram initData.

========================================================
7) АВТОПРОВЕРКА “ВСЁ РАБОТАЕТ” (МИНИ E2E)
========================================================
Добавь в репо npm script:
- npm run test:smoke
Который:
- поднимает api в test env (или использует supertest)
- прогоняет основные сценарии:
  - создать bath booking, принять, предоплата, закрыть оплату
  - создать quad session, создать quad booking, подтвердить
  - открыть смену, cash_in, expense, incasation
  - worklog create
Это можно сделать как jest тесты с supertest (без UI).

========================================================
8) ФИКСЫ ФРОНТА ДЛЯ “ВСЁ РАБОТАЕТ”
========================================================
- guest/quad-booking.tsx полностью на русском и реально создает бронь
- ops/bookings.tsx показывает брони и даёт действия (accept/prepay/close где можно)
- ops/bookings/new создаёт домик и баню (через админские endpoints)
- owner/settings.tsx читает/сохраняет настройки и влияет на логику
- 404 по-русски

========================================================
9) В КОНЦЕ СДЕЛАЙ “ПРОГОН” И ПОЧИНИ ВСЁ
========================================================
- npm run lint
- npm run test
- npm run test:smoke
- ручная проверка в браузере (dev): вход по ролям, все страницы, отправка форм

Финальный результат:
- проект запускается одним docker-compose или двумя командами (api + webapp)
- все функции работают без ошибок
- все новые endpoints покрыты smoke тестами
- документация обновлена (README + docs/FUNCTIONS_MAP.md + docs/QA_CHECKLIST.md)

Не задавай вопросов. Делай разумные дефолты. Если чего-то нет — добавь минимально.
