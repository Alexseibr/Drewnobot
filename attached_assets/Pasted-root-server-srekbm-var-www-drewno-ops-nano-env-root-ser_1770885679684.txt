root@server-srekbm:/var/www/drewno-ops# nano .env
root@server-srekbm:/var/www/drewno-ops# # Перейти в папку проекта (уточнитепуть)
root@server-srekbm:/var/www/drewno-ops# cd /var/www/drewno-ops
root@server-srekbm:/var/www/drewno-ops# # или
root@server-srekbm:/var/www/drewno-ops# cd /home/drewno/app
-bash: cd: /home/drewno/app: No such file or directory
root@server-srekbm:/var/www/drewno-ops#
root@server-srekbm:/var/www/drewno-ops# # Затем подтянуть изменения
root@server-srekbm:/var/www/drewno-ops# git pull origin main
remote: Enumerating objects: 48, done.
remote: Counting objects: 100% (48/48), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 48 (delta 41), reused 48 (delta 41), pack-reused 0 (from 0)
Unpacking objects: 100% (48/48), 679.38 KiB | 2.26 MiB/s, done.
From https://github.com/Alexseibr/Drewnobot
 * branch            main       -> FETCH_HEAD
   309ec26..f999e38  main       -> origin/main
Updating 309ec26..f999e38
Fast-forward
 ...PM-express-GET-api-admin-cleaning-_1770290978137.txt | 129 ----------
 ...-Bot-Checking-for-SPA-access-instr_1770291180395.txt | 100 --------
 ...-Bot-Checking-for-SPA-access-instr_1770291242452.txt | 187 --------------
 ...-Bot-Checking-for-SPA-access-instr_1770291277916.txt | 233 ------------------
 ...r-www-drewno-ops-1-PostgreSQL-root_1770290755941.txt | 309 ------------------------
 ...r-www-drewno-ops-1-root-server-sre_1770291316997.txt |  90 -------
 ...r-www-drewno-ops-cd-var-www-drewno_1770290896044.txt | 180 --------------
 ...r-www-drewno-ops-root-server-srekb_1770290283919.txt | 133 ----------
 ...r-www-drewno-ops-root-server-srekb_1770885352723.txt |  41 ++++
 ...r-www-drewno-ops-sudo-u-postgres-p_1770291361257.txt |  78 ------
 ...r-www-drewno-ops-sudo-u-postgres-p_1770291388147.txt | 115 ---------
 attached_assets/image_1770290172856.png                 | Bin 247780 -> 0 bytes
 attached_assets/image_1770290237729.png                 | Bin 218896 -> 0 bytes
 attached_assets/image_1770882764933.png                 | Bin 645357 -> 0 bytes
 attached_assets/image_1770885399514.png                 | Bin 0 -> 193060 bytes
 ...\260_2026-02-12_\320\262_11.36.21_1770885406563.png" | Bin 0 -> 271564 bytes
 client/src/pages/ops/staff.tsx                          | 100 +++++++-
 package-lock.json                                       |  13 +
 package.json                                            |   1 +
 server/index.ts                                         |   6 +
 server/routes.ts                                        |  61 +----
 server/telegram-bot.ts                                  |  16 +-
 22 files changed, 173 insertions(+), 1619 deletions(-)
 delete mode 100644 attached_assets/Pasted-0-drewno-ops-2-28-04-PM-express-GET-api-admin-cleaning-_1770290978137.txt
 delete mode 100644 attached_assets/Pasted-0-drewno-ops-Telegram-Bot-Checking-for-SPA-access-instr_1770291180395.txt
 delete mode 100644 attached_assets/Pasted-0-drewno-ops-Telegram-Bot-Checking-for-SPA-access-instr_1770291242452.txt
 delete mode 100644 attached_assets/Pasted-0-drewno-ops-Telegram-Bot-Checking-for-SPA-access-instr_1770291277916.txt
 delete mode 100644 attached_assets/Pasted-root-server-srekbm-var-www-drewno-ops-1-PostgreSQL-root_1770290755941.txt
 delete mode 100644 attached_assets/Pasted-root-server-srekbm-var-www-drewno-ops-1-root-server-sre_1770291316997.txt
 delete mode 100644 attached_assets/Pasted-root-server-srekbm-var-www-drewno-ops-cd-var-www-drewno_1770290896044.txt
 delete mode 100644 attached_assets/Pasted-root-server-srekbm-var-www-drewno-ops-root-server-srekb_1770290283919.txt
 create mode 100644 attached_assets/Pasted-root-server-srekbm-var-www-drewno-ops-root-server-srekb_1770885352723.txt
 delete mode 100644 attached_assets/Pasted-root-server-srekbm-var-www-drewno-ops-sudo-u-postgres-p_1770291361257.txt
 delete mode 100644 attached_assets/Pasted-root-server-srekbm-var-www-drewno-ops-sudo-u-postgres-p_1770291388147.txt
 delete mode 100644 attached_assets/image_1770290172856.png
 delete mode 100644 attached_assets/image_1770290237729.png
 delete mode 100644 attached_assets/image_1770882764933.png
 create mode 100644 attached_assets/image_1770885399514.png
 create mode 100644 "attached_assets/\320\241\320\275\320\270\320\274\320\276\320\272_\321\215\320\272\321\200\320\260\320\275\320\260_2026-02-12_\320\262_11.36.21_1770885406563.png"
root@server-srekbm:/var/www/drewno-ops#
root@server-srekbm:/var/www/drewno-ops# # Установить зависимости
root@server-srekbm:/var/www/drewno-ops# npm install

added 1 package, and audited 535 packages in 3s

70 packages are looking for funding
  run `npm fund` for details

4 vulnerabilities (1 moderate, 3 high)

To address all issues, run:
  npm audit fix

Run `npm audit` for details.
root@server-srekbm:/var/www/drewno-ops#
root@server-srekbm:/var/www/drewno-ops# # Собрать проект
root@server-srekbm:/var/www/drewno-ops# npm run build

> rest-express@1.0.0 build
> tsx script/build.ts

building client...
vite v7.3.0 building client environment for production...
transforming (1) src/main.tsx
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
✓ 3222 modules transformed.
../dist/public/index.html                            1.07 kB │ gzip:   0.60kB
../dist/public/assets/drewno-logo-Bw8WbCk8.webp    328.56 kB
../dist/public/assets/index-CZtiF9QP.css            85.71 kB │ gzip:  14.04kB
../dist/public/assets/index-mIoHGbrh.js          1,343.37 kB │ gzip: 356.73kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 26.86s
building server...

  dist/index.cjs  1.4mb ⚠️

⚡ Done in 1263ms
root@server-srekbm:/var/www/drewno-ops#
root@server-srekbm:/var/www/drewno-ops# # Перезапустить
root@server-srekbm:/var/www/drewno-ops# pm2 restart drewno-ops
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [drewno-ops](ids: [ 0 ])
[PM2] [drewno-ops](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory  │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ drewno-ops         │ fork     │ 5    │ online    │ 0%       │ 22.2mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@server-srekbm:/var/www/drewno-ops# nano .envroot@server-srekbm:/var/www/drewno-ops# npm run build && pm2 restart 0

> rest-express@1.0.0 build
> tsx script/build.ts

building client...
vite v7.3.0 building client environment for production...
transforming (1) src/main.tsx
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
✓ 3222 modules transformed.
../dist/public/index.html                            1.07 kB │ gzip:   0.60kB
../dist/public/assets/drewno-logo-Bw8WbCk8.webp    328.56 kB
../dist/public/assets/index-CZtiF9QP.css            85.71 kB │ gzip:  14.04kB
../dist/public/assets/index-mIoHGbrh.js          1,343.37 kB │ gzip: 356.73kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 25.09s
building server...

  dist/index.cjs  1.4mb ⚠️

⚡ Done in 823ms
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [0](ids: [ '0' ])
[PM2] [drewno-ops](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory  │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ drewno-ops         │ fork     │ 6    │ online    │ 0%       │ 18.5mb  │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@server-srekbm:/var/www/drewno-ops# # Просмотр логов в реальном времени
root@server-srekbm:/var/www/drewno-ops# pm2 logs drewno-ops
[TAILING] Tailing last 15 lines for [drewno-ops] process (change the value with --lines option)
/root/.pm2/logs/drewno-ops-out.log last 15 lines:
0|drewno-o | 11:41:00 AM [scheduler]     - Laundry check-in: 15:00 daily
0|drewno-o | 11:41:00 AM [scheduler]   - Thermostat:
0|drewno-o | 11:41:00 AM [scheduler]     - Prompt: 12:00 daily
0|drewno-o | 11:41:00 AM [scheduler]     - Base temps: 12:05 daily
0|drewno-o | 11:41:00 AM [scheduler]     - Heating: 14:30 daily
0|drewno-o | 11:41:00 AM [scheduler]   - SPA Guest Notifications:
0|drewno-o | 11:41:00 AM [scheduler]     - Morning reminder: 09:00 daily
0|drewno-o | 11:41:00 AM [scheduler]     - Access instructions: every 5 min
0|drewno-o | 11:41:00 AM [scheduler] [ThermostatScheduler] Houses initialized
0|drewno-o | 11:41:02 AM [express] GET /api/ops/today 200 in 70ms :: {"tasks":[{"id":"add0247c-a1b7-4fdc-a66e-184f1aee4389","date":"2026-02-12","type":"other","title":"Утренний обход территории","checklist":["Проверка входа","Осмотр парковки","Проверка освещения"],"status":"open","priority":"normal","notified":false,"createdBySystem":true,"meta":null,"createdAt":"2026-02-12T03:00:00.041Z"},{"id":"3dcd44c9-e712-4e3f-bede-740c461b3360","date":"2026-02-12","type":"other","title":"Подготовка дров","checklist":null,"status":"open","priority":"normal","notified":false,"createdBySystem":true,"meta":null,"createdAt":"2026-02-12T03:00:00.088Z"},{"id":"af570403-ff4a-4d12-9cef-95e15c93fefd","date":"2026-02-12","type":"trash_prep","title":"Вынос мусора","checklist":null,"status":"open","priority":"normal","notified":false,"createdBySystem":true,"meta":null,"createdAt":"2026-02-12T03:00:00.098Z"}],"cottageBookings":[],"bathBookings":[],"currentShift":{"id":"a72dc17e-5b0d-4695-849c-d754761ccc9e","openedAt":"2025-12-24T21:34:10.408Z","openedBy":"admin","isOpen":true,"visibleToAdmin":true,"cashBox":"main"},"stats":{"checkInsToday":0,"checkOutsToday":0,"bathsToday":0,"openTasks":3,"cashBalance":16683}}
0|drewno-o | 11:41:02 AM [express] GET /api/cash/shift/current 200 in 29ms :: {"currentShift":{"id":"a72dc17e-5b0d-4695-849c-d754761ccc9e","openedAt":"2025-12-24T21:34:10.408Z","openedBy":"admin","isOpen":true,"visibleToAdmin":true,"cashBox":"main"},"transactions":[],"balance":0}
0|drewno-o | 11:41:02 AM [express] GET /api/auth/me 200 in 25ms :: {"id":"9354fddc-eb32-4d80-8856-ebce7c48c663","telegramId":"374243315","name":"А.А","role":"SUPER_ADMIN"}
0|drewno-o | [eWeLink] Device ID length: 10
0|drewno-o | [eWeLink] Device ID prefix: 100
0|drewno-o | 11:41:04 AM [express] POST /api/admin/gate/open 500 in 7ms :: {"error":"Failed to connect to eWeLink"}

/root/.pm2/logs/drewno-ops-error.log last 15 lines:
0|drewno-o |   table: undefined,
0|drewno-o |   column: undefined,
0|drewno-o |   dataType: undefined,
0|drewno-o |   constraint: undefined,
0|drewno-o |   file: 'auth.c',
0|drewno-o |   line: '343',
0|drewno-o |   routine: 'auth_failed'
0|drewno-o | }
0|drewno-o | Error: ENOENT: no such file or directory, stat '/var/www/drewno-ops/dist/public/index.html'
0|drewno-o | Error: ENOENT: no such file or directory, stat '/var/www/drewno-ops/dist/public/index.html'
0|drewno-o | [eWeLink] Login failed: TypeError: pR.default.WebAPI is not a constructor
0|drewno-o |     at pG (/var/www/drewno-ops/dist/index.cjs:70:215163)
0|drewno-o |     at qy (/var/www/drewno-ops/dist/index.cjs:70:215771)
0|drewno-o |     at /var/www/drewno-ops/dist/index.cjs:247:56589
0|drewno-o |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)

0|drewno-ops  | [eWeLink] Device ID length: 10
0|drewno-ops  | [eWeLink] Device ID prefix: 100
0|drewno-ops  | [eWeLink] Login failed: TypeError: pR.default.WebAPI is nota constructor
0|drewno-ops  |     at pG (/var/www/drewno-ops/dist/index.cjs:70:215163)
0|drewno-ops  |     at qy (/var/www/drewno-ops/dist/index.cjs:70:215771)
0|drewno-ops  |     at /var/www/drewno-ops/dist/index.cjs:247:56589
0|drewno-ops  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|drewno-ops  | 11:41:16 AM [express] POST /api/admin/gate/open 500 in 18ms:: {"error":"Failed to connect to eWeLink"}