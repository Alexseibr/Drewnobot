startup^C
root@server-srekbm:/var/www/drewno-ops# pm2 logs drewno-ops --lines 30
[TAILING] Tailing last 30 lines for [drewno-ops] process (change the value with --lines option)
/root/.pm2/logs/drewno-ops-error.log last 30 lines:
0|drewno-o | ,role:r[0].role,note:r[0].note||void 0,createdBy:r[0].createdBy,usedBy:r[0].usedBy||void 0,usedAt:r[0].usedAt||void 0,createdAt:r[0].createdAt}}async createStaffInvitation(e){let n=(0,ke.randomUUID)(),r=new Date().toISOString(),i=_s(e.phone);if(!i)throw new Error("\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430. \u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F \u043C\u0438\u043D\u0438\u043C\u0443\u043C 7 \u0446\u0438\u0444\u0440.");let a={id:n,phone:i,role:e.role,note:e.note,createdBy:e.createdBy,createdAt:r};return await C.insert(Ze).values({id:a.id,phone:a.phone,role:a.role,note:a.note||null,createdBy:a.createdBy,createdAt:a.createdAt}),a}async useStaffInvitation(e,n){if(!(await C.select().from(Ze).where($(Ze.id,e)))[0])return;let i=new Date().toISOString();await C.update(Ze).set({usedBy:n,usedAt:i}).where($(Ze.id,e));let a=await C.select().from(Ze).where($(Ze.id,e));if(a[0])return{id:a[0].id,phone:a[0].phone,role:a[0].role,note:a[0].note||void 0,createdBy:a[0].createdBy,usedBy:a[0].usedBy||void 0,usedAt:a[0].usedAt||void 0,createdAt:a[0].createdAt}}async deleteStaffInvitation(e){return await C.delete(Ze).where($(Ze.id,e)),!0}}});var b,ru=A(()=>{"use strict";k_();b=new nu});var j_={};ou(j_,{handleTelegramUpdate:()=>Bh,initTelegramBot:()=>jh,notifyNewQuadBooking:()=>e3,removeTelegramWebhook:()=>XO,sendEveningReminder:()=>Ph,sendMaintenanceAlerts:()=>Ih,sendMorningSummary:()=>Eh,setupTelegramWebhook:()=>Ps});async function Es(t,e={}){if(!Cs)return console.error("[Telegram Bot] No bot token configured"),null;let r=await(await fetch(`https://api.telegram.org/bot${Cs}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return r.ok||console.error(`[Telegram Bot] API error:${t}`,r),r}function P_(){return Ch}async function Pn(t,e,n={}){return Es("sendMessage",{chat_id:t,text:e,parse_mode:"HTML",...n})}async function GO(t,e){return Es("answerCallbackQuery",{callback_query_id:t,text:e})}function I_(){let t=P_();return{inline_keyboard:[[{text:"\u0417\u0430\u0431\u0440\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0431\u0430\u043D\u044E",web_app:{url:`${t}/guest/bath`}}],[{text:"\u0417\u0430\u0431\u0440\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u0432\u0430\u0434\u0440\u043E\u0446\u0438\u043A\u043B\u044B",web_app:{url:`${t}/guest/quads`}}],[{text:"\u0421\u041F\u0410-\u043A\u043E\u043C\u043F\u043B\u0435\u043A\u0441",web_app:{url:`${t}/guest/spa`}}],[{text:"\u041D\u0430\u0448 \u0441\u0430\u0439\u0442",web_app:{url:t}}],[{text:"\u042F \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A",web_app:{url:`${t}/staff-login`}}]]}}function B_(t){let e=P_(),n=[];return t==="INSTRUCTOR"&&(n.push([{text:"\u041C\u043E\u0438 \u0441\u0435\u0430\u043D\u0441\u044B",web_app:{url:`${e}/instructor`}}]),n.push([{text:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0442\u043E\u0440\u0430\u043C\u0438",web_app:{url:`${e}/instructor/manage`}}])),(t==="ADMIN"||t==="OWNER"||t==="SUPER_ADMIN")&&(n.push([{text:"\u041F\u0430\u043D\u0435\u043B\u044C \u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F",web_app:{url:`${e}/ops`}}]),n.push([{text:"\u0411\u0440\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F",web_app:{url:`${e}/ops/bookings`}}]),n.push([{text:"\u041A\u0430\u0441\u0441\u0430",web_app:{url:`${e}/ops/cash`}}]),n.push([{text:"\u0417\u0430\u0434\u0430\u0447\u0438",web_app:{url:`${e}/ops/tasks`}}])),(t==="OWNER"||t==="SUPER_ADMIN")&&n.push([{text:"\u0410\u043D\u0430\u043B\u0438\u0442\u0438\u043A\u0430",web_app:{url:`${e}/owner/analytics`}}]),t==="SUPER_ADMIN"&&n.push([{text:"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u043E\u0442\u0440\u0443\u0434\u043D\u0438\u043A\u0430\u043C\u0438",web_app:{url:`${e}/admin/staff`}}]),n.push([{text:"\u0413\u043B\u0430\u0432\u043D\u0430\u044F",web_app:{url:e}}]),{inline_keyboard:n}}async function JO(t,e){let n=e.id.toString(),r=await b.getUserByTelegramId(n),i=[e.first_name,e.last_name].filter(Boolean).join(" ");if(r&&r.isActive&&r.role!=="GUEST"){let a=ZO[r.role]||r.role;await Pn(t,`\u0414\u043E\u0431\u0440\u043E \u043F\u043E\u0436\u0430\u043B\u043E\u0432\u0430\u0442\u044C, <b>${r.name||i}</b>!
0|drewno-o |            
0|drewno-o |
0|drewno-o | Error: DATABASE_URL must be set. Did you forget to provisiona database?
0|drewno-o |     at /var/www/drewno/dist/index.cjs:70:124568
0|drewno-o |     at /var/www/drewno/dist/index.cjs:1:225
0|drewno-o |     at /var/www/drewno/dist/index.cjs:70:124872
0|drewno-o |     at /var/www/drewno/dist/index.cjs:1:225
0|drewno-o |     at /var/www/drewno/dist/index.cjs:70:160760
0|drewno-o |     at /var/www/drewno/dist/index.cjs:1:225
0|drewno-o |     at Object.<anonymous> (/var/www/drewno/dist/index.cjs:108:1428)
0|drewno-o |     at Module._compile (node:internal/modules/cjs/loader:1521:14)
0|drewno-o |     at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)
0|drewno-o |     at Module.load (node:internal/modules/cjs/loader:1266:32)
0|drewno-o |
0|drewno-o | Node.js v20.19.6

/root/.pm2/logs/drewno-ops-out.log last 30 lines:
0|drewno-o | 11:34:25 AM [scheduler] Scheduler initialized:
0|drewno-o | 11:34:25 AM [scheduler]   - Shift auto-closure: 23:00 daily
0|drewno-o | 11:34:25 AM [scheduler]   - Daily tasks: 06:00 daily
0|drewno-o | 11:34:25 AM [scheduler]   - Weekly tasks: 06:00 Monday
0|drewno-o | 11:34:25 AM [scheduler]   - Monthly tasks: 06:00 1st of month
0|drewno-o | 11:34:25 AM [scheduler] Checked for missed shift closures onstartup
0|drewno-o |
0|drewno-o | > rest-express@1.0.0 start
0|drewno-o | > NODE_ENV=production node dist/index.cjs
0|drewno-o |
0|drewno-o | 11:35:46 AM [express] serving on port 5000
0|drewno-o | [Telegram Bot] No bot token configured, skipping initialization
0|drewno-o | 11:35:46 AM [scheduler] Scheduler initialized:
0|drewno-o | 11:35:46 AM [scheduler]   - Shift auto-closure: 23:00 daily
0|drewno-o | 11:35:46 AM [scheduler]   - Daily tasks: 06:00 daily
0|drewno-o | 11:35:46 AM [scheduler]   - Weekly tasks: 06:00 Monday
0|drewno-o | 11:35:46 AM [scheduler]   - Monthly tasks: 06:00 1st of month
0|drewno-o | 11:35:47 AM [scheduler] Checked for missed shift closures onstartup
0|drewno-o |
0|drewno-o | > rest-express@1.0.0 start
0|drewno-o | > NODE_ENV=production node dist/index.cjs
0|drewno-o |
0|drewno-o | 11:36:16 AM [express] serving on port 5000
0|drewno-o | [Telegram Bot] No bot token configured, skipping initialization
0|drewno-o | 11:36:16 AM [scheduler] Scheduler initialized:
0|drewno-o | 11:36:16 AM [scheduler]   - Shift auto-closure: 23:00 daily
0|drewno-o | 11:36:16 AM [scheduler]   - Daily tasks: 06:00 daily
0|drewno-o | 11:36:16 AM [scheduler]   - Weekly tasks: 06:00 Monday
0|drewno-o | 11:36:16 AM [scheduler]   - Monthly tasks: 06:00 1st of month
0|drewno-o | 11:36:16 AM [scheduler] Checked for missed shift closures onstartup

pm2 show drewno-ops | grep cwd^C
root@server-srekbm:/var/www/drewno-ops# pm2 show drewno-ops | grep cwd
│ exec cwd          │ /var/www/drewno-ops                  │
root@server-srekbm:/var/www/drewno-ops# cd /var/www/drewno-ops
pm2 delete drewno-ops
DATABASE_URL="postgresql://drewno:39903990aSs\$@localhost:5432/drewno" pm2 start npm --name "drewno-ops" --cwd /var/www/drewno-ops -- run start
pm2 save
[PM2] Applying action deleteProcessId on app [drewno-ops](ids: [ 0 ])
[PM2] [drewno-ops](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Starting /usr/bin/npm in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ drewno-ops         │ fork     │ 0    │ online    │ 0%       │ 26.3mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
root@server-srekbm:/var/www/drewno-ops#