0|drewno-o | 8:00:27 AM [scheduler] Checked for missed shift closures on startup
^C
root@server-srekbm:/var/www/drewno# # Проверить что порт 3000 слушает
curl http://localhost:3000

# Если ошибка - перезапустить через ecosystem.config.cjs
pm2 restart drewno-ops

# Проверить логи
pm2 logs drewno-ops --lines 10
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#1a365d" />
    <meta name="description" content="Village Drewno - Загородный комплекс. Аренда домиков. Баня. Горячая купель." />
    <title>Village Drewno</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="module" crossorigin src="/assets/index-BJFXhmI0.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-C8cveR4v.css">
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [drewno-ops](ids: [ 0 ])
[PM2] [drewno-ops](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ drewno-ops         │ fork     │ 1    │ online    │ 0%       │ 25.9mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 10 lines for [drewno-ops] process (change the value with --lines option)
/root/.pm2/logs/drewno-ops-error.log last 10 lines:
0|drewno-o |     at /var/www/drewno/dist/index.cjs:70:124872
0|drewno-o |     at /var/www/drewno/dist/index.cjs:1:225
0|drewno-o |     at /var/www/drewno/dist/index.cjs:70:160760
0|drewno-o |     at /var/www/drewno/dist/index.cjs:1:225
0|drewno-o |     at Object.<anonymous> (/var/www/drewno/dist/index.cjs:108:1428)
0|drewno-o |     at Module._compile (node:internal/modules/cjs/loader:1521:14)
0|drewno-o |     at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)
0|drewno-o |     at Module.load (node:internal/modules/cjs/loader:1266:32)
0|drewno-o |
0|drewno-o | Node.js v20.19.6

/root/.pm2/logs/drewno-ops-out.log last 10 lines:
0|drewno-o | 8:00:26 AM [express] serving on port 3000
0|drewno-o | [Telegram Bot] Setting up webhook for production: https://d.drewno.by
0|drewno-o | [Telegram Bot] Webhook set successfully
0|drewno-o | [Telegram Bot] Notifications scheduled
0|drewno-o | 8:00:27 AM [scheduler] Scheduler initialized:
0|drewno-o | 8:00:27 AM [scheduler]   - Shift auto-closure: 23:00 daily
0|drewno-o | 8:00:27 AM [scheduler]   - Daily tasks: 06:00 daily
0|drewno-o | 8:00:27 AM [scheduler]   - Weekly tasks: 06:00 Monday
0|drewno-o | 8:00:27 AM [scheduler]   - Monthly tasks: 06:00 1st of month
0|drewno-o | 8:00:27 AM [scheduler] Checked for missed shift closures on startup

0|drewno-ops  | > rest-express@1.0.0 start
0|drewno-ops  | > NODE_ENV=production node dist/index.cjs
0|drewno-ops  | 8:04:56 AM [express] serving on port 3000
0|drewno-ops  | [Telegram Bot] Setting up webhook for production: https://d.drewno.by
0|drewno-ops  | [Telegram Bot] Webhook set successfully
0|drewno-ops  | [Telegram Bot] Notifications scheduled
0|drewno-ops  | 8:04:57 AM [scheduler] Scheduler initialized:
0|drewno-ops  | 8:04:57 AM [scheduler]   - Shift auto-closure: 23:00 daily
0|drewno-ops  | 8:04:57 AM [scheduler]   - Daily tasks: 06:00 daily
0|drewno-ops  | 8:04:57 AM [scheduler]   - Weekly tasks: 06:00 Monday
0|drewno-ops  | 8:04:57 AM [scheduler]   - Monthly tasks: 06:00 1st of month
0|drewno-ops  | 8:04:57 AM [scheduler] Checked for missed shift closures on startup
^C
root@server-srekbm:/var/www/drewno# pm2 startup
pm2 save
[PM2] Init System found: systemd
Platform systemd
Template
[Unit]
Description=PM2 process manager
Documentation=https://pm2.keymetrics.io/
After=network.target

[Service]
Type=forking
User=root
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
Environment=PM2_HOME=/root/.pm2
PIDFile=/root/.pm2/pm2.pid
Restart=on-failure

ExecStart=/usr/lib/node_modules/pm2/bin/pm2 resurrect
ExecReload=/usr/lib/node_modules/pm2/bin/pm2 reload all
ExecStop=/usr/lib/node_modules/pm2/bin/pm2 kill

[Install]
WantedBy=multi-user.target

Target path
/etc/systemd/system/pm2-root.service
Command list
[ 'systemctl enable pm2-root' ]
[PM2] Writing init configuration in /etc/systemd/system/pm2-root.service
[PM2] Making script booting at startup...
[PM2] [-] Executing: systemctl enable pm2-root...
[PM2] [v] Command successfully executed.
+---------------------------------------+
[PM2] Freeze a process list on reboot via:
$ pm2 save

[PM2] Remove init script via:
$ pm2 unstartup systemd
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
root@server-srekbm:/var/www/drewno# cd /var/www/drewno
git pull origin main
npm install
npm run build
pm2 restart drewno-ops
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (10/10), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 8 (delta 5), reused 8 (delta 5), pack-reused 0 (from 0)
Unpacking objects: 100% (8/8), 5.58 KiB | 2.79 MiB/s, done.
From https://github.com/Alexseibr/Drewnobot
 * branch            main       -> FETCH_HEAD
   4708889..90b364c  main       -> origin/main
Updating 4708889..90b364c
Fast-forward
 ...Ubuntu-22-04-5-LTS-GNU-Linux-5-15-0-160-gene_1766378950138.txt | 224 +++++++++++++++++++++++++++++
 ...EATE-DATABASE-drewno-CREATE-DATABASE-postgre_1766379284387.txt |  80 +++++++++++
 2 files changed, 304 insertions(+)
 create mode 100644 attached_assets/Pasted-Welcome-to-Ubuntu-22-04-5-LTS-GNU-Linux-5-15-0-160-gene_1766378950138.txt
 create mode 100644 attached_assets/Pasted-postgres-CREATE-DATABASE-drewno-CREATE-DATABASE-postgre_1766379284387.txt

up to date, audited 481 packages in 2s

67 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

> rest-express@1.0.0 build
> tsx script/build.ts

building client...
vite v7.3.0 building client environment for production...
transforming (1) src/main.tsx
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
✓ 2586 modules transformed.
../dist/public/index.html                          1.07 kB │ gzip:   0.60 kB
../dist/public/assets/drewno-logo-Bw8WbCk8.webp  328.56 kB
../dist/public/assets/index-C8cveR4v.css          76.75 kB │ gzip:  12.50 kB
../dist/public/assets/index-BJFXhmI0.js          720.20 kB │ gzip: 198.82 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 12.93s
building server...

  dist/index.cjs  1.2mb ⚠️

⚡ Done in 371ms
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [drewno-ops](ids: [ 0 ])
[PM2] [drewno-ops](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ drewno-ops         │ fork     │ 2    │ online    │ 0%       │ 25.8mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@server-srekbm:/var/www/drewno# # Проверить какие конфиги активны
ls -la /etc/nginx/sites-enabled/

# Посмотреть содержимое конфига
cat /etc/nginx/sites-enabled/d.drewno.by

# Проверить что приложение слушает порт
ss -tlnp | grep 3000

# Проверить статус PM2
pm2 status
total 8
drwxr-xr-x 2 root root 4096 Dec 22 08:03 .
drwxr-xr-x 8 root root 4096 Dec 22 08:02 ..
lrwxrwxrwx 1 root root   38 Dec 21 21:26 d.drewno.by -> /etc/nginx/sites-available/d.drewno.by
lrwxrwxrwx 1 root root   34 Dec 21 14:21 default -> /etc/nginx/sites-available/default
server {
    server_name d.drewno.by;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/d.drewno.by/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/d.drewno.by/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot


}
server {
    if ($host = d.drewno.by) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


    listen 80;
    server_name d.drewno.by;
    return 404; # managed by Certbot


}LISTEN 0      511          0.0.0.0:3000      0.0.0.0:*    users:(("node",pid=307366,fd=18))
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ drewno-ops         │ fork     │ 2    │ online    │ 0%       │ 55.2mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@server-srekbm:/var/www/drewno#