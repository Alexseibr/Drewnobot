Ты — Replit Agent/Codex. Продолжай работу в текущем репозитории (НЕ создавай новый). У проекта уже есть часть API и страницы. Твоя задача: ДОБАВИТЬ новый функционал (SPA-комплекс с типами бронирований, SMS-верификация, отзывы, стоп-дни инструкторов, два Telegram-бота) и довести до состояния “всё работает”.

========================================================
0) ЧТО ДОБАВЛЯЕМ (НОВЫЕ ФУНКЦИИ)
========================================================
A) SPA-комплекс (2 комплекса):
- SPA1: большая купель
- SPA2: маленькая купель
Типы SPA-бронирований (bookingType):
1) bath_only — только баня (до 5 чел, 150₽/3ч)
2) tub_only — только купель:
   - 6-8 чел: 180₽
   - до 4 чел: 150₽
3) bath_with_tub — баня + купель:
   - до 9 чел: 330₽
   - упрощение/вариант цены: 300₽ (если нужен второй тариф)
4) terrace_only — только терраса (лето, 90₽/3ч)

B) Квадроциклы:
- Сессии 30 или 60 минут
- Выбор количества квадроциклов (1..4)
- Привязка к одному инструктору
- Стоп-дни (blocked dates) управляются инструктором через команды

C) Бани (отдельные, как раньше):
- базовая 3ч + доп. часы
- опции: маленькая/большая купель, мангал, угли

D) Коттеджи (как раньше):
- заезд/выезд, гости
- опция маленькой купели

E) SMS-верификация:
- отправка 4-значного кода на телефон
- проверка кода
- получение verificationToken, который обязателен для создания бронирования гостем (SPA/баня/квадро)

F) Отзывы:
- после визита клиент может оставить отзыв (о SPA/бане/квадро/коттедже)
- владелец может “опубликовать на сайт” (флаг isPublished)

========================================================
1) СТАТУСЫ (ЖЁСТКО СОБЛЮДАТЬ)
========================================================
SPA/Баня:
pending_call → awaiting_prepayment → confirmed → completed / cancelled / expired

Квадро:
pending_call → confirmed → completed / cancelled

Коттеджи:
planned → checked_in → completed / cancelled / no_show

========================================================
2) РОЛИ (НЕ ПЕРЕПУТАТЬ)
========================================================
OWNER:
- аналитика, все брони, настройки, публикация отзывов, уведомления

ADMIN:
- подтверждение/отмена SPA/баня, приём оплат/предоплат, касса
- видит только “сегодня + предстоящие” и только текущую смену кассы

INSTRUCTOR:
- расписание квадро, подтверждение/отмена, стоп-дни
- не видит кассу и брони коттеджей/SPA (кроме quad)

========================================================
3) TELEGRAM: ДВА БОТА (МИНИМАЛЬНО)
========================================================
Сделай поддержку ДВУХ токенов:
- TELEGRAM_CLIENT_BOT_TOKEN (бот для клиентов)
- TELEGRAM_INSTRUCTOR_BOT_TOKEN (бот для инструктора)

Если второй токен не задан — инструкторские команды обслуживать через основной бот (fallback), но лучше поддержать 2.

3.1) Клиентский бот команды:
- /start, /menu: меню с кнопками:
  - “SPA-комплекс” -> открыть webapp route /guest/spa
  - “Квадроциклы” -> /guest/quads
  - “Доп. услуги” -> просто текст + контакты
  - “Сайт drewno.by” -> ссылка
  - “Оставить отзыв” -> открыть /guest/review (или кнопка появляется после completed)

3.2) Бот инструкторов:
- /start, /menu — меню инструктора
- /today — брони на сегодня
- /block ДД.ММ.ГГГГ [причина] — заблокировать дату
- /unblock ДД.ММ.ГГГГ — разблокировать дату
- /dates — список заблокированных дат
- /help — справка

========================================================
4) УВЕДОМЛЕНИЯ (TELEGRAM)
========================================================
- Новая бронь SPA -> ADMIN + OWNER
- Новая бронь квадро -> INSTRUCTOR + OWNER
- Утреннее расписание -> INSTRUCTOR + OWNER (ежедневно)
- Напоминание клиенту -> за день до визита (по всем типам бронирований)

Если chatId не настроены, логируй [NOTIFY] в консоль.

========================================================
5) SPA: ДАННЫЕ, ПРАВИЛА, АНТИ-ОВЕРБУКИНГ
========================================================
5.1) SPA-ресурсы:
- SPA1 (big tub)
- SPA2 (small tub)

5.2) Длительность:
- базовая: 3 часа для bath_only и terrace_only и bath_with_tub
- tub_only: фиксированное окно 3 часа (если иначе — сделай конфиг, но MVP = 3ч)

5.3) Овербукинг:
- НЕЛЬЗЯ пересекать брони в рамках одного SPA ресурса для статусов:
  pending_call, awaiting_prepayment, confirmed
- completed/cancelled/expired не блокируют

5.4) Время закрытия:
- Настройка closeTime (по умолчанию 22:00)
- endTime <= closeTime

5.5) Цены SPA:
Храни в Settings/ServicePrice и рассчитывай на бэке.
Для MVP можно зашить дефолты, но настройки владельца должны позволять менять:
- bath_only base3h = 150
- terrace_only base3h = 90
- tub_only:
  - upTo4 = 150
  - from6to8 = 180
  (правило по guestsCount)
- bath_with_tub:
  - upTo9 = 330
  - optionalAlt = 300 (сделай второй тариф в настройках как “bath_with_tub_alt”)
Важно: цена выбирается автоматически по bookingType + guestsCount, но админ может вручную скорректировать итог при приёме оплаты (через priceSnapshot).

========================================================
6) SMS-ВЕРИФИКАЦИЯ (MVP)
========================================================
Добавь 2 эндпойнта:
- POST /api/guest/sms/send { phone } -> { ok:true, cooldownSeconds }
- POST /api/guest/sms/verify { phone, code } -> { verificationToken }

MVP-реализация:
- Код 4 цифры, хранить в Mongo коллекции SmsCode (phone, codeHash, expiresAt, attempts, createdAt)
- expires 10 минут, attempts max 5
- В DEV режиме разреши “code=0000” (или выводи код в лог), чтобы тестировать без провайдера

Интеграция с smsline.by:
- если SMSLINE_API_URL/login/api_key присутствуют (env), отправляй реально
- иначе: логируй, но выдавай ok:true

Требование:
- POST /api/guest/spa-bookings, /api/guest/bath-bookings, /api/guest/quad-bookings
  ДОЛЖНЫ требовать verificationToken (в заголовке X-Verify-Token или body) и валидировать его.

========================================================
7) ОТЗЫВЫ
========================================================
Сущность Review:
- bookingRef: { kind:'spa'|'bath'|'quad'|'cottage', id }
- customer: { name?, phone }
- rating 1..5
- text
- createdAt
- isPublished boolean
- publishedAt?, publishedBy?

Гость:
- POST /api/guest/reviews (только если booking completed и номер совпадает)
Владелец:
- GET /api/owner/reviews
- POST /api/owner/reviews/:id/publish (toggle publish)
Публикация “на сайт” = isPublished=true (MVP).

========================================================
8) НОВЫЕ API ЭНДПОИНТЫ (ДОБАВИТЬ)
========================================================
Гость:
- GET /api/guest/spa/availability?date=YYYY-MM-DD
- POST /api/guest/spa-bookings
- POST /api/guest/sms/send
- POST /api/guest/sms/verify
- POST /api/guest/reviews

Админ:
- POST /api/admin/spa-bookings/:id/accept
- POST /api/admin/spa-bookings/:id/cancel
- POST /api/admin/spa-bookings/:id/prepayment
- POST /api/admin/spa-bookings/:id/close-payment
- (если ещё нет) подобные для bath-bookings (accept/prepayment/close-payment)

Инструктор:
- GET /api/instructor/quad-schedule/:date
- POST /api/instructor/blocked-dates (add)
- DELETE /api/instructor/blocked-dates/:date (remove)
- GET /api/instructor/blocked-dates
- POST /api/instructor/quad-bookings/:id/confirm
- POST /api/instructor/quad-bookings/:id/cancel

Владелец:
- GET /api/owner/analytics/summary (расширить, чтобы включало SPA по типам)
- GET/PUT /api/owner/settings
- GET /api/owner/reviews
- POST /api/owner/reviews/:id/publish

========================================================
9) FRONTEND: НОВЫЕ/ДОПОЛНЕННЫЕ СТРАНИЦЫ
========================================================
Добавь гостевую страницу:
- /guest/spa  (многошаговый процесс как баня)
Шаги:
1) SMS: ввод телефона -> отправить код -> ввести код -> получить verificationToken
2) Выбор SPA (SPA1/SPA2 с фото)
3) Выбор типа брони (bath_only/tub_only/bath_with_tub/terrace_only) + подсказки по условиям
4) Выбор даты и времени + длительности (3ч) + проверка availability
5) Кол-во гостей
6) ФИО
7) Итоговая цена (показывать расчёт)
8) Отправить заявку -> “Заявка отправлена, с вами свяжется администратор для предоплаты”

Интегрировать SMS-верификацию также в /guest/bath и /guest/quads:
- перед созданием брони требовать verificationToken (если нет — предложить пройти SMS)

Добавь страницу отзывов:
- /guest/review (появляется через ссылку в меню, но разрешать только если есть completed бронирование на номер)
- простой: рейтинг + текст + отправить

Owner settings:
- добавь SPA цены и типы, closeTime, сезонность terrace_only (toggle “лето”)
- добавь chatIds для admin/owner/instructor (кто получает уведомления)

========================================================
10) КВАДРО: СТОП-ДНИ И БУФЕР 30 МИН
========================================================
- Availability для гостя должен учитывать:
  - blocked dates (инструктор заблокировал дату)
  - буфер после сессии (session bufferUntil)
- Если дата заблокирована: показывать “На выбранную дату квадроциклы недоступны: {причина}”

Инструкторские команды /block и /unblock:
- записывать в Mongo: BlockedDate { date, reason, createdBy, createdAt }

========================================================
11) ТЕСТЫ (ДОБАВИТЬ/РАСШИРИТЬ)
========================================================
Добавь smoke-тесты:
- SMS send/verify (DEV)
- SPA availability + create booking (with verificationToken)
- Admin accept/prepayment/close-payment for SPA
- Blocked date prevents quad availability

========================================================
12) ВЫПОЛНЯЙ ПОШАГОВО И ДОКУМЕНТИРУЙ
========================================================
1) Добавь модели и миграцию/инициализацию дефолтных Settings/Prices для SPA типов.
2) Реализуй SMS (dev-friendly) и подключи к гостевым booking endpoints.
3) Реализуй SPA availability + booking + admin actions.
4) Реализуй два Telegram бота (или fallback) и команды инструктора (block/unblock/today).
5) Добавь UI /guest/spa + интеграция SMS для /guest/bath и /guest/quads.
6) Реализуй отзывы (guest create + owner publish).
7) Расширь owner analytics, чтобы показывало SPA по типам и выручку.
8) Прогони тесты и исправь всё, чтобы “всё работает”.

Не задавай вопросов. Делай разумные дефолты. Ничего не ломай. Все тексты на русском.
