root@server-srekbm:/var/www/drewno-ops# cd /var/www/drewno-ops
root@server-srekbm:/var/www/drewno-ops# git pull origin main
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (10/10), done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 6 (delta 4), reused 6 (delta 4), pack-reused 0 (from 0)
Unpacking objects: 100% (6/6), 187.55 KiB | 1.20 MiB/s, done.
From https://github.com/Alexseibr/Drewnobot
 * branch            main       -> FETCH_HEAD
   c9a2301..27ec402  main       -> origin/main
Updating c9a2301..27ec402
Fast-forward
 attached_assets/image_1771229645726.png | Bin 0 -> 252133 bytes
 server/telegram-bot.ts                  |   4 +++-
 2 files changed, 3 insertions(+), 1 deletion(-)
 create mode 100644 attached_assets/image_1771229645726.png
root@server-srekbm:/var/www/drewno-ops# npm run build

> rest-express@1.0.0 build
> tsx script/build.ts


building client...
vite v7.3.0 building client environment for production...
transforming (4) src/App.tsx
A PostCSS plugin did not pass the `from` option to `postcss.parse`. This may cause imported assets to be incorrectly transformed. If you've recently added a PostCSS plugin that raised this warning, please contact the package author to fix the issue.
‚úì 3222 modules transformed.
../dist/public/index.html                            1.07 kB ‚îÇ gzip:   0.60kB
../dist/public/assets/drewno-logo-Bw8WbCk8.webp    328.56 kB
../dist/public/assets/index-DvL4bvTR.css            89.76 kB ‚îÇ gzip:  14.52kB
../dist/public/assets/index-BbGivI6r.js          1,344.47 kB ‚îÇ gzip: 357.17kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
‚úì built in 24.46s
building server...

  dist/index.cjs  1.5mb ‚ö†Ô∏è

‚ö° Done in 1265ms
root@server-srekbm:/var/www/drewno-ops# pm2 restart drewno-ops
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [drewno-ops](ids: [ 0 ])
[PM2] [drewno-ops](0) ‚úì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ name               ‚îÇ mode     ‚îÇ ‚Ü∫    ‚îÇ status    ‚îÇ cpu      ‚îÇ memory  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0  ‚îÇ drewno-ops         ‚îÇ fork     ‚îÇ 60   ‚îÇ online    ‚îÇ 0%       ‚îÇ 18.5mb  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
root@server-srekbm:/var/www/drewno-ops# pm2 logs drewno-ops --lines 50
[TAILING] Tailing last 50 lines for [drewno-ops] process (change the value with --lines option)
/root/.pm2/logs/drewno-ops-error.log last 50 lines:
0|drewno-o |   where: undefined,
0|drewno-o |   schema: undefined,
0|drewno-o |   table: undefined,
0|drewno-o |   column: undefined,
0|drewno-o |   dataType: undefined,
0|drewno-o |   constraint: undefined,
0|drewno-o |   file: 'parse_relation.c',
0|drewno-o |   line: '3647',
0|drewno-o |   routine: 'errorMissingColumn'
0|drewno-o | }
0|drewno-o | [eWeLink OAuth] No tokens found. Owner must authorize at /api/ewelink/auth
0|drewno-o | [eWeLink OAuth] Failed to load tokens: error: column "ewelink_tokens" does not exist
0|drewno-o |     at /var/www/drewno-ops/dist/index.cjs:64:13330
0|drewno-o |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|drewno-o |     at async /var/www/drewno-ops/dist/index.cjs:70:37918
0|drewno-o |     at async jp.getSiteSettings (/var/www/drewno-ops/dist/index.cjs:70:112209)
0|drewno-o |     at async Lte (/var/www/drewno-ops/dist/index.cjs:81:9337)
0|drewno-o |     at async qte (/var/www/drewno-ops/dist/index.cjs:81:9517)
0|drewno-o |     at async Ub (/var/www/drewno-ops/dist/index.cjs:81:10110)
0|drewno-o |     at async Wte (/var/www/drewno-ops/dist/index.cjs:103:1864)
0|drewno-o |     at async $b (/var/www/drewno-ops/dist/index.cjs:103:1143)
0|drewno-o |     at async /var/www/drewno-ops/dist/index.cjs:260:116710 {
0|drewno-o |   length: 115,
0|drewno-o |   severity: 'ERROR',
0|drewno-o |   code: '42703',
0|drewno-o |   detail: undefined,
0|drewno-o |   hint: undefined,
0|drewno-o |   position: '136',
0|drewno-o |   internalPosition: undefined,
0|drewno-o |   internalQuery: undefined,
0|drewno-o |   where: undefined,
0|drewno-o |   schema: undefined,
0|drewno-o |   table: undefined,
0|drewno-o |   column: undefined,
0|drewno-o |   dataType: undefined,
0|drewno-o |   constraint: undefined,
0|drewno-o |   file: 'parse_relation.c',
0|drewno-o |   line: '3647',
0|drewno-o |   routine: 'errorMissingColumn'
0|drewno-o | }
0|drewno-o | [eWeLink OAuth] No tokens found. Owner must authorize at /api/ewelink/auth
0|drewno-o | [eWeLink OAuth] No tokens found. Owner must authorize at /api/ewelink/auth
0|drewno-o | [eWeLink OAuth] No tokens found. Owner must authorize at /api/ewelink/auth
0|drewno-o | [eWeLink OAuth] No tokens found. Owner must authorize at /api/ewelink/auth
0|drewno-o | [DB] Error in getSiteSettings: column "ewelink_tokens" does not exist
0|drewno-o | [DB] ewelink_tokens column missing, attempting to query other fields
0|drewno-o | [eWeLink OAuth] No tokens found. Owner must authorize at /api/ewelink/auth
0|drewno-o | [DB] Error in getSiteSettings: column "ewelink_tokens" does not exist
0|drewno-o | [DB] ewelink_tokens column missing, attempting to query other fields
0|drewno-o | [eWeLink OAuth] No tokens found. Owner must authorize at /api/ewelink/auth

/root/.pm2/logs/drewno-ops-out.log last 50 lines:
0|drewno-o | 11:13:18 AM [scheduler]   - Nightly chat cleanup: 03:00 daily
0|drewno-o | 11:13:18 AM [scheduler]   - Notifications:
0|drewno-o | 11:13:18 AM [scheduler]     - Bath summary: 09:00 daily
0|drewno-o | 11:13:18 AM [scheduler]     - Climate ON: 12:00 daily
0|drewno-o | 11:13:18 AM [scheduler]     - Climate OFF: 14:00 daily
0|drewno-o | 11:13:18 AM [scheduler]     - Laundry check-in: 15:00 daily
0|drewno-o | 11:13:18 AM [scheduler]   - Thermostat:
0|drewno-o | 11:13:18 AM [scheduler]     - Prompt: 12:00 daily
0|drewno-o | 11:13:18 AM [scheduler]     - Base temps: 12:05 daily
0|drewno-o | 11:13:18 AM [scheduler]     - Heating: 14:30 daily
0|drewno-o | 11:13:18 AM [scheduler]   - SPA Guest Notifications:
0|drewno-o | 11:13:18 AM [scheduler]     - Morning reminder: 09:00 daily
0|drewno-o | 11:13:18 AM [scheduler]     - Access instructions: every 5 min
0|drewno-o | 11:13:18 AM [scheduler] [ThermostatScheduler] Houses initialized
0|drewno-o | 11:13:20 AM [express] GET /api/ewelink/auth 302 in 11ms
0|drewno-o | [Telegram Bot] Checking for SPA access instructions to send...
0|drewno-o |
0|drewno-o | [Process] Received SIGINT, shutting down gracefully...
0|drewno-o | [Process] HTTP server closed
0|drewno-o |
0|drewno-o | > rest-express@1.0.0 start
0|drewno-o | > NODE_ENV=production node dist/index.cjs
0|drewno-o |
0|drewno-o | [dotenv@17.2.4] injecting env (6) from .env -- tip: üîê encryptwith Dotenvx: https://dotenvx.com
0|drewno-o | 11:15:31 AM [express] serving on port 5000
0|drewno-o | [Telegram Bot] Setting up webhook for production: https://d.drewno.by
0|drewno-o | [Telegram Bot] Webhook set successfully
0|drewno-o | [Telegram Bot] Notifications scheduled
0|drewno-o | 11:15:32 AM [scheduler] Scheduler initialized:
0|drewno-o | 11:15:32 AM [scheduler]   - Daily tasks: 06:00 daily
0|drewno-o | 11:15:32 AM [scheduler]   - Weekly tasks: 06:00 Monday
0|drewno-o | 11:15:32 AM [scheduler]   - Monthly tasks: 06:00 1st of month
0|drewno-o | 11:15:32 AM [scheduler]   - Weather check: 18:00 daily
0|drewno-o | 11:15:32 AM [scheduler]   - Scheduled task notifications: every minute
0|drewno-o | 11:15:32 AM [scheduler]   - Nightly chat cleanup: 03:00 daily
0|drewno-o | 11:15:32 AM [scheduler]   - Notifications:
0|drewno-o | 11:15:32 AM [scheduler]     - Bath summary: 09:00 daily
0|drewno-o | 11:15:32 AM [scheduler]     - Climate ON: 12:00 daily
0|drewno-o | 11:15:32 AM [scheduler]     - Climate OFF: 14:00 daily
0|drewno-o | 11:15:32 AM [scheduler]     - Laundry check-in: 15:00 daily
0|drewno-o | 11:15:32 AM [scheduler]   - Thermostat:
0|drewno-o | 11:15:32 AM [scheduler]     - Prompt: 12:00 daily
0|drewno-o | 11:15:32 AM [scheduler]     - Base temps: 12:05 daily
0|drewno-o | 11:15:32 AM [scheduler]     - Heating: 14:30 daily
0|drewno-o | 11:15:32 AM [scheduler]   - SPA Guest Notifications:
0|drewno-o | 11:15:32 AM [scheduler]     - Morning reminder: 09:00 daily
0|drewno-o | 11:15:32 AM [scheduler]     - Access instructions: every 5 min
0|drewno-o | 11:15:32 AM [scheduler] [ThermostatScheduler] Houses initialized
0|drewno-o | 11:15:33 AM [express] GET /api/ewelink/auth 302 in 11ms
0|drewno-o | 11:15:46 AM [express] GET /api/ewelink/auth 302 in 3ms